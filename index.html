<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shopping List</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <h1>Shopping List</h1>
        <button id="toggle-dark-mode" onclick="toggleDarkMode()">
            <i class="fas fa-moon"></i> Toggle Dark Mode
        </button>
    </header>
    <div id="search-container">
        <div id="search-bar">
            <input type="text" id="search-input" placeholder="Search">
            <button id="add-filter-button" onclick="addFilter()">Add Filter</button>
        </div>
    </div>
    <div id="Story-container">
        <div id="Story-bar">
            <input type="text" id="story-input" placeholder="What do we need to buy?">
            <button id="add-story-button" onclick="addStory()">Add Item</button>
        </div>
    </div>
    <div id="active-filters">
        <h3>Active Filters:</h3>
        <ul id="active-filter-list"></ul>
    </div>

    <div id="content">
        <!-- Top 3/4 of the screen -->
        <div class="list-container">
            <h2>Item</h2>
            <hr>
            <ul id="myUL-item" class="shopping-list"></ul>
        </div>
        <div class="list-container">
            <h2>Cost</h2>
            <hr>
            <ul id="myUL-cost" class="shopping-list"></ul>
        </div>
        <div class="list-container">
            <h2>Count</h2>
            <hr>
            <ul id="myUL-count" class="shopping-list"></ul>
        </div>

        <!-- Bottom 1/4 of the screen -->
        <div class="totals-container">
            <h2>Totals</h2>
            <hr>
            <p>Total Cost: <span id="total-cost">0.00</span></p>
            <p>Total Items: <span id="total-items">0</span></p>
        </div>
    </div>
    <script>
var activeFilters = [];
var shoppingList = {
    items: [],
    costs: [],
    counts: [],
};
var isDarkMode = false; // Variable to track dark mode state

function loadShoppingList() {
    var storedShoppingList = localStorage.getItem("shoppingList");
    if (storedShoppingList) {
        shoppingList = JSON.parse(storedShoppingList);
        updateShoppingListUI();
    }
}

// Call loadShoppingList() to display stored shopping list when the page loads
loadShoppingList();

// Function to update and display active filters
function updateActiveFilters() {
    var activeFilterList = document.getElementById("active-filter-list");
    activeFilterList.innerHTML = '';
    for (var i = 0; i < activeFilters.length; i++) {
        var filterText = activeFilters[i].source;
        activeFilterList.innerHTML += `
            <li>${filterText} <button onclick="removeFilter(${i})">Remove</button></li>
        `;
    }
}

// Function to add a new filter
function addFilter() {
    var searchInput = document.getElementById("search-input").value;
    if (searchInput) {
        activeFilters.push(new RegExp(searchInput, 'i'));
        document.getElementById("active-filter-list").innerHTML += `
            <li>${searchInput} <button onclick="removeFilter(${activeFilters.length - 1})">Remove</button></li>
        `;
        filter(); // Update the filter immediately
    }
}

// Function to remove a filter
function removeFilter(index) {
    activeFilters.splice(index, 1);
    updateActiveFilters();
    filter();
}

// Function to filter the shopping list based on search input and active filters
function filter() {
    var input = document.getElementById('search-input');
    var shoppingListItems = shoppingList.items;
    var shoppingListCosts = shoppingList.costs;
    var shoppingListCounts = shoppingList.counts;

    for (var i = 0; i < shoppingListItems.length; i++) {
        var isVisible = true; // Initialize to true

        // Apply active filters using regex
        for (var j = 0; j < activeFilters.length; j++) {
            if (!activeFilters[j].test(shoppingListItems[i])) {
                isVisible = false;
                break; // No need to check other filters if one fails
            }
        }

        // Display or hide the item based on visibility
        var itemElement = document.getElementById(`item-${i}`);
        if (itemElement) {
            itemElement.style.display = isVisible ? "" : "none";
        }
    }
}

// Function to add a new item, cost, and count to the shopping list
function addStory() {
    const itemName = document.getElementById('story-input').value;
    const itemCost = prompt("Enter the cost of the item (e.g., $5.00):");
    const itemCount = prompt("Enter the count of the item:");

    if (itemName.trim() === "" || itemCost === null || itemCount === null) {
        // Handle empty input or user cancellation (you may want to display an error message)
        return;
    }

    shoppingList.items.push(itemName);
    shoppingList.costs.push(itemCost);
    shoppingList.counts.push(itemCount);

    localStorage.setItem("shoppingList", JSON.stringify(shoppingList));

    // Clear the input field after adding the item
    document.getElementById('story-input').value = "";

    // Update active filters when a new item is added
    updateActiveFilters();
    updateShoppingListUI();
}

// Function to update the shopping list UI
function updateShoppingListUI() {
    var itemUl = document.getElementById("myUL-item");
    var costUl = document.getElementById("myUL-cost");
    var countUl = document.getElementById("myUL-count");

    itemUl.innerHTML = "";
    costUl.innerHTML = "";
    countUl.innerHTML = "";

    for (var i = 0; i < shoppingList.items.length; i++) {
        itemUl.innerHTML += `<li id="item-${i}">${shoppingList.items[i]}</li>`;
        costUl.innerHTML += `<li>${shoppingList.costs[i]}</li>`;
        countUl.innerHTML += `<li>${shoppingList.counts[i]}</li>`;
    }

    filter(); // Reapply filtering after updating the shopping list UI
}

// Function to toggle dark mode
function toggleDarkMode() {
    isDarkMode = !isDarkMode; // Toggle dark mode state

    // Apply dark mode or light mode styles to the entire document
    if (isDarkMode) {
        document.body.classList.add("dark-mode");
        document.body.classList.remove("light-mode");
    } else {
        document.body.classList.remove("dark-mode");
        document.body.classList.add("light-mode");
    }
}

// Initialize the filtering
var searchInput = document.getElementById("search-input");
searchInput.addEventListener('input', filter);
</script>
</html>
